<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<TITLE>Page 172</TITLE>

<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<BODY bgcolor="#FFFFFF" vlink="blue" link="blue" >
<p style="position:absolute;top:0px;left:0px"><img src="images/azure-cognitive-services-openai0172.png" width="892px" height="1252px">
</img></p>
<p style="position:absolute;top:371px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h683w_h24w_h;letter-spacing:0.34366px;">To&nbsp;apply&nbsp;the&nbsp;OpenAI&nbsp;Completion&nbsp;service&nbsp;to&nbsp;the&nbsp;dataframe&nbsp;that&nbsp;you&nbsp;just&nbsp;created,&nbsp;create</span></p>
<p style="position:absolute;top:399px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h690w_h24w_h;letter-spacing:0.35228px;">an&nbsp;OpenAICompletion&nbsp;object&nbsp;that&nbsp;serves&nbsp;as&nbsp;a&nbsp;distributed&nbsp;client.&nbsp;Parameters&nbsp;of&nbsp;the&nbsp;service</span></p>
<p style="position:absolute;top:431px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h617w_h24w_h;letter-spacing:0.29475px;">can&nbsp;be&nbsp;set&nbsp;either&nbsp;with&nbsp;a&nbsp;single&nbsp;value,&nbsp;or&nbsp;by&nbsp;a&nbsp;column&nbsp;of&nbsp;the&nbsp;dataframe&nbsp;with&nbsp;the</span></p>
<p style="position:absolute;top:460px;left:96px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#161616;w_h669w_h24w_h;letter-spacing:0.47502px;">appropriate&nbsp;setters&nbsp;on&nbsp;the&nbsp;OpenAICompletion&nbsp;object.&nbsp;Here,&nbsp;we're&nbsp;setting&nbsp;maxTokens&nbsp;to</span></p>
<p style="position:absolute;top:491px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h681w_h24w_h;letter-spacing:0.30959px;">200.&nbsp;A&nbsp;token&nbsp;is&nbsp;around&nbsp;four&nbsp;characters,&nbsp;and&nbsp;this&nbsp;limit&nbsp;applies&nbsp;to&nbsp;the&nbsp;sum&nbsp;of&nbsp;the&nbsp;prompt</span></p>
<p style="position:absolute;top:520px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h697w_h24w_h;letter-spacing:0.33933px;">and&nbsp;the&nbsp;result.&nbsp;We're&nbsp;also&nbsp;setting&nbsp;the&nbsp;promptCol&nbsp;parameter&nbsp;with&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;prompt</span></p>
<p style="position:absolute;top:550px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h199w_h24w_h;letter-spacing:0.40342px;">column&nbsp;in&nbsp;the&nbsp;dataframe.</span></p>
<p style="position:absolute;top:604px;left:115px"><span style="virtical-align:top;font-size:12px;font-family:AAAAAC+SegoeUI;color:#161616;w_h45w_h19w_h;letter-spacing:1.19594px;">Python</span></p>
<p style="position:absolute;top:1068px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h668w_h24w_h;letter-spacing:0.34815px;">Now&nbsp;that&nbsp;you&nbsp;have&nbsp;the&nbsp;dataframe&nbsp;and&nbsp;the&nbsp;completion&nbsp;client,&nbsp;you&nbsp;can&nbsp;transform&nbsp;your</span></p>
<p style="position:absolute;top:1096px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h647w_h24w_h;letter-spacing:0.33719px;">input&nbsp;dataset&nbsp;and&nbsp;add&nbsp;a&nbsp;column&nbsp;called&nbsp;completions&nbsp;with&nbsp;all&nbsp;of&nbsp;the&nbsp;information&nbsp;the</span></p>
<p style="position:absolute;top:1127px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h435w_h24w_h;letter-spacing:0.31691px;">service&nbsp;adds.&nbsp;We'll&nbsp;select&nbsp;out&nbsp;just&nbsp;the&nbsp;text&nbsp;for&nbsp;simplicity.</span></p>
<p style="position:absolute;top:1180px;left:115px"><span style="virtical-align:top;font-size:12px;font-family:AAAAAC+SegoeUI;color:#161616;w_h45w_h19w_h;letter-spacing:1.19594px;">Python</span></p>
<p style="position:absolute;top:61px;left:116px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#161616;w_h234w_h18w_h;letter-spacing:0.62626px;">df&nbsp;=&nbsp;spark.createDataFrame(</span></p>
<p style="position:absolute;top:83px;left:151px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#161616;w_h9w_h18w_h;letter-spacing:0.00000px;">[</span></p>
<p style="position:absolute;top:104px;left:186px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#a31515;w_h190w_h18w_h;letter-spacing:0.39686px;">(&quot;Hello&nbsp;my&nbsp;name&nbsp;is&quot;,),</span></p>
<p style="position:absolute;top:125px;left:186px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#a31515;w_h294w_h18w_h;letter-spacing:0.41194px;">(&quot;The&nbsp;best&nbsp;code&nbsp;is&nbsp;code&nbsp;that's&quot;,),</span></p>
<p style="position:absolute;top:147px;left:186px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#a31515;w_h165w_h18w_h;letter-spacing:0.41684px;">(&quot;SynapseML&nbsp;is&nbsp;&quot;,),</span></p>
<p style="position:absolute;top:168px;left:151px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#161616;w_h9w_h18w_h;letter-spacing:0.00000px;">]</span></p>
<p style="position:absolute;top:190px;left:116px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#a31515;w_h139w_h18w_h;letter-spacing:0.54119px;">).toDF(&quot;prompt&quot;)</span></p>
<p style="position:absolute;top:266px;left:96px"><span style="virtical-align:top;font-size:30px;font-family:AAAAAB+SegoeUI-Semibold;color:#161616;font-weight:bold;w_h654w_h43w_h;letter-spacing:0.44520px;">Create&nbsp;the&nbsp;OpenAICompletion&nbsp;Apache&nbsp;Spark</span></p>
<p style="position:absolute;top:307px;left:96px"><span style="virtical-align:top;font-size:30px;font-family:AAAAAB+SegoeUI-Semibold;color:#161616;font-weight:bold;w_h80w_h43w_h;letter-spacing:0.79072px;">client</span></p>
<p style="position:absolute;top:651px;left:116px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#0101fd;w_h424w_h18w_h;letter-spacing:0.64155px;">from&nbsp;synapse.ml.cognitive&nbsp;import&nbsp;OpenAICompletion</span></p>
<p style="position:absolute;top:694px;left:116px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#161616;w_h121w_h18w_h;letter-spacing:0.51661px;">completion&nbsp;=&nbsp;(</span></p>
<p style="position:absolute;top:715px;left:151px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#161616;w_h156w_h18w_h;letter-spacing:0.00000px;">OpenAICompletion()</span></p>
<p style="position:absolute;top:736px;left:151px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#161616;w_h208w_h18w_h;letter-spacing:0.00000px;">.setSubscriptionKey(key)</span></p>
<p style="position:absolute;top:758px;left:151px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#161616;w_h303w_h18w_h;letter-spacing:0.00000px;">.setDeploymentName(deployment_name)</span></p>
<p style="position:absolute;top:779px;left:151px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#a31515;w_h528w_h18w_h;letter-spacing:0.71767px;">.setUrl(&quot;https://{}.openai.azure.com/&quot;.format(resource_name))</span></p>
<p style="position:absolute;top:800px;left:151px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#161616;w_h156w_h18w_h;letter-spacing:0.91318px;">.setMaxTokens(200)</span></p>
<p style="position:absolute;top:822px;left:151px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#a31515;w_h199w_h18w_h;letter-spacing:0.60231px;">.setPromptCol(&quot;prompt&quot;)</span></p>
<p style="position:absolute;top:843px;left:151px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#a31515;w_h182w_h18w_h;letter-spacing:0.58781px;">.setErrorCol(&quot;error&quot;)</span></p>
<p style="position:absolute;top:865px;left:151px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#a31515;w_h242w_h18w_h;letter-spacing:0.63140px;">.setOutputCol(&quot;completions&quot;)</span></p>
<p style="position:absolute;top:886px;left:116px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#161616;w_h9w_h18w_h;letter-spacing:0.00000px;">)</span></p>
<p style="position:absolute;top:962px;left:96px"><span style="virtical-align:top;font-size:30px;font-family:AAAAAB+SegoeUI-Semibold;color:#161616;font-weight:bold;w_h495w_h43w_h;letter-spacing:0.39066px;">Transform&nbsp;the&nbsp;dataframe&nbsp;with&nbsp;the</span></p>
<p style="position:absolute;top:1004px;left:96px"><span style="virtical-align:top;font-size:30px;font-family:AAAAAB+SegoeUI-Semibold;color:#161616;font-weight:bold;w_h373w_h43w_h;letter-spacing:0.56578px;">OpenAICompletion&nbsp;client</span></p>
</BODY>
</HTML>
