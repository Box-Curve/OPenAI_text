<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<TITLE>Page 91</TITLE>

<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>
<BODY bgcolor="#FFFFFF" vlink="blue" link="blue" >
<p style="position:absolute;top:0px;left:0px"><img src="images/azure-cognitive-services-openai0091.png" width="892px" height="1252px">
</img></p>
<p style="position:absolute;top:467px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h657w_h24w_h;letter-spacing:0.31183px;">When&nbsp;you&nbsp;run&nbsp;the&nbsp;code&nbsp;above&nbsp;you&nbsp;will&nbsp;get&nbsp;a&nbsp;blank&nbsp;console&nbsp;window.&nbsp;Enter&nbsp;your&nbsp;first</span></p>
<p style="position:absolute;top:495px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h652w_h24w_h;letter-spacing:0.32821px;">question&nbsp;in&nbsp;the&nbsp;window&nbsp;and&nbsp;then&nbsp;hit&nbsp;enter.&nbsp;Once&nbsp;the&nbsp;response&nbsp;is&nbsp;returned,&nbsp;you&nbsp;can</span></p>
<p style="position:absolute;top:524px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h366w_h24w_h;letter-spacing:0.37639px;">repeat&nbsp;the&nbsp;process&nbsp;and&nbsp;keep&nbsp;asking&nbsp;questions.</span></p>
<p style="position:absolute;top:649px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h686w_h24w_h;letter-spacing:0.33174px;">The&nbsp;previous&nbsp;example&nbsp;will&nbsp;run&nbsp;until&nbsp;you&nbsp;hit&nbsp;the&nbsp;model's&nbsp;token&nbsp;limit.&nbsp;With&nbsp;each&nbsp;question</span></p>
<p style="position:absolute;top:678px;left:96px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#161616;w_h675w_h24w_h;letter-spacing:0.41086px;">asked,&nbsp;and&nbsp;answer&nbsp;received,&nbsp;the&nbsp;messages&nbsp;array&nbsp;grows&nbsp;in&nbsp;size.&nbsp;The&nbsp;token&nbsp;limit&nbsp;for&nbsp;gpt-</span></p>
<p style="position:absolute;top:714px;left:96px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#161616;w_h67w_h18w_h;letter-spacing:1.05150px;">35-turbo</span></p>
<p style="position:absolute;top:709px;left:170px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h623w_h24w_h;letter-spacing:0.33354px;">is&nbsp;4096&nbsp;tokens,&nbsp;whereas&nbsp;the&nbsp;token&nbsp;limits&nbsp;for&nbsp;gpt-4&nbsp;and&nbsp;gpt-4-32k&nbsp;are&nbsp;8192&nbsp;and</span></p>
<p style="position:absolute;top:740px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h677w_h24w_h;letter-spacing:0.35745px;">32768&nbsp;respectively.&nbsp;These&nbsp;limits&nbsp;include&nbsp;the&nbsp;token&nbsp;count&nbsp;from&nbsp;both&nbsp;the&nbsp;message&nbsp;array</span></p>
<p style="position:absolute;top:768px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h676w_h24w_h;letter-spacing:0.35431px;">sent&nbsp;and&nbsp;the&nbsp;model&nbsp;response.&nbsp;The&nbsp;number&nbsp;of&nbsp;tokens&nbsp;in&nbsp;the&nbsp;messages&nbsp;array&nbsp;combined</span></p>
<p style="position:absolute;top:798px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h700w_h24w_h;letter-spacing:0.33444px;">with&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;max_tokens&nbsp;parameter&nbsp;must&nbsp;stay&nbsp;under&nbsp;these&nbsp;limits&nbsp;or&nbsp;you'll&nbsp;receive</span></p>
<p style="position:absolute;top:829px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h67w_h24w_h;letter-spacing:0.41819px;">an&nbsp;error.</span></p>
<p style="position:absolute;top:875px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h691w_h24w_h;letter-spacing:0.33885px;">It's&nbsp;your&nbsp;responsibility&nbsp;to&nbsp;ensure&nbsp;the&nbsp;prompt&nbsp;and&nbsp;completion&nbsp;falls&nbsp;within&nbsp;the&nbsp;token&nbsp;limit.</span></p>
<p style="position:absolute;top:905px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h701w_h24w_h;letter-spacing:0.32854px;">This&nbsp;means&nbsp;that&nbsp;for&nbsp;longer&nbsp;conversations,&nbsp;you&nbsp;need&nbsp;to&nbsp;keep&nbsp;track&nbsp;of&nbsp;the&nbsp;token&nbsp;count&nbsp;and</span></p>
<p style="position:absolute;top:933px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h441w_h24w_h;letter-spacing:0.31498px;">only&nbsp;send&nbsp;the&nbsp;model&nbsp;a&nbsp;prompt&nbsp;that&nbsp;falls&nbsp;within&nbsp;the&nbsp;limit.</span></p>
<p style="position:absolute;top:980px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h653w_h24w_h;letter-spacing:0.34478px;">The&nbsp;following&nbsp;code&nbsp;sample&nbsp;shows&nbsp;a&nbsp;simple&nbsp;chat&nbsp;loop&nbsp;example&nbsp;with&nbsp;a&nbsp;technique&nbsp;for</span></p>
<p style="position:absolute;top:1009px;left:96px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h481w_h24w_h;letter-spacing:0.36786px;">handling&nbsp;a&nbsp;4096&nbsp;token&nbsp;count&nbsp;using&nbsp;OpenAI's&nbsp;tiktoken&nbsp;library.</span></p>
<p style="position:absolute;top:1055px;left:96px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#161616;w_h698w_h24w_h;letter-spacing:0.42227px;">The&nbsp;code&nbsp;requires&nbsp;tiktoken&nbsp;0.3.0.&nbsp;If&nbsp;you&nbsp;have&nbsp;an&nbsp;older&nbsp;version&nbsp;run&nbsp;pip&nbsp;install&nbsp;tiktoken</span></p>
<p style="position:absolute;top:1092px;left:96px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#161616;w_h76w_h18w_h;letter-spacing:1.01395px;">--upgrade</span></p>
<p style="position:absolute;top:1087px;left:174px"><span style="virtical-align:top;font-size:16px;font-family:AAAAAC+SegoeUI;color:#161616;w_h4w_h24w_h;letter-spacing:0.00000px;">.</span></p>
<p style="position:absolute;top:1141px;left:115px"><span style="virtical-align:top;font-size:12px;font-family:AAAAAC+SegoeUI;color:#161616;w_h45w_h19w_h;letter-spacing:1.19594px;">Python</span></p>
<p style="position:absolute;top:42px;left:116px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#008000;w_h234w_h18w_h;letter-spacing:0.54798px;">resource's&nbsp;endpoint&nbsp;value&nbsp;.</span></p>
<p style="position:absolute;top:64px;left:116px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#a31515;w_h381w_h18w_h;letter-spacing:0.57611px;">openai.api_key&nbsp;=&nbsp;os.getenv(&quot;OPENAI_API_KEY&quot;)</span></p>
<p style="position:absolute;top:106px;left:116px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#a31515;w_h658w_h18w_h;letter-spacing:0.41405px;">conversation=[{&quot;role&quot;:&nbsp;&quot;system&quot;,&nbsp;&quot;content&quot;:&nbsp;&quot;You&nbsp;are&nbsp;a&nbsp;helpful&nbsp;assistant.&quot;}]</span></p>
<p style="position:absolute;top:149px;left:116px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#07704a;w_h104w_h18w_h;letter-spacing:0.97398px;">while(True):</span></p>
<p style="position:absolute;top:170px;left:151px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#161616;w_h173w_h18w_h;letter-spacing:0.57987px;">user_input&nbsp;=&nbsp;input()</span></p>
<p style="position:absolute;top:192px;left:151px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#161616;w_h520w_h18w_h;letter-spacing:0.47285px;">conversation.append({&quot;role&quot;:&nbsp;&quot;user&quot;,&nbsp;&quot;content&quot;:&nbsp;user_input})</span></p>
<p style="position:absolute;top:235px;left:151px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#161616;w_h346w_h18w_h;letter-spacing:0.67652px;">response&nbsp;=&nbsp;openai.ChatCompletion.create(</span></p>
<p style="position:absolute;top:256px;left:186px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#008000;w_h554w_h18w_h;letter-spacing:0.46388px;">engine=&quot;gpt-3.5-turbo&quot;,&nbsp;#&nbsp;The&nbsp;deployment&nbsp;name&nbsp;you&nbsp;chose&nbsp;when&nbsp;you</span></p>
<p style="position:absolute;top:277px;left:116px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#008000;w_h312w_h18w_h;letter-spacing:0.49535px;">deployed&nbsp;the&nbsp;ChatGPT&nbsp;or&nbsp;GPT-4&nbsp;model.</span></p>
<p style="position:absolute;top:299px;left:186px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#161616;w_h199w_h18w_h;letter-spacing:0.60232px;">messages&nbsp;=&nbsp;conversation</span></p>
<p style="position:absolute;top:320px;left:151px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#161616;w_h9w_h18w_h;letter-spacing:0.00000px;">)</span></p>
<p style="position:absolute;top:363px;left:151px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#a31515;w_h623w_h18w_h;letter-spacing:0.50820px;">conversation.append({&quot;role&quot;:&nbsp;&quot;assistant&quot;,&nbsp;&quot;content&quot;:&nbsp;response['choices']</span></p>
<p style="position:absolute;top:384px;left:116px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#a31515;w_h234w_h18w_h;letter-spacing:0.87657px;">[0]['message']['content']})</span></p>
<p style="position:absolute;top:406px;left:151px"><span style="virtical-align:top;font-size:13px;font-family:AAAAAE+Consolas;color:#a31515;w_h563w_h18w_h;letter-spacing:0.51223px;">print(&quot;\n&quot;&nbsp;+&nbsp;response['choices'][0]['message']['content']&nbsp;+&nbsp;&quot;\n&quot;)</span></p>
<p style="position:absolute;top:586px;left:96px"><span style="virtical-align:top;font-size:30px;font-family:AAAAAB+SegoeUI-Semibold;color:#161616;font-weight:bold;w_h361w_h43w_h;letter-spacing:0.56997px;">Managing&nbsp;conversations</span></p>
</BODY>
</HTML>
